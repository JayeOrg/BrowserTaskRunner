services:
    sitecheck:
        container_name: sitecheck
        user: "${HOST_UID:-1000}:${HOST_GID:-1000}"
        build:
            context: ../..
            dockerfile: stack/infra/Dockerfile
            args:
                - SOURCE_HASH=${SOURCE_HASH:-unknown}
        env_file:
            - ../../.env
        environment:
            - TASK_NAME
            - SITE_CHECK_INTERVAL_MS=${SITE_CHECK_INTERVAL_MS:-300000}
            - ENABLE_VNC=${ENABLE_VNC:-true}
            - PERSIST_CHROME_PROFILE=${PERSIST_CHROME_PROFILE:-false}
            - SAFE_MODE=${SAFE_MODE:-false}
            # Configurable display/port settings (match run.ts defaults)
            - DISPLAY_NUM=${DISPLAY_NUM:-99}
            - WS_PORT=${WS_PORT:-8765}
        ports:
            - "5900:5900" # VNC for debugging
        volumes:
            - ../../logs:/app/logs
            - ../../vault.db:/app/vault.db:ro
        stop_grace_period: "0s"
        restart: "no"
